<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wagyu Blessing Amulet | #wagyu_blessing</title>
  <meta name="description" content="Create a Japanese Omamori-style blessing card for travelers. Shareable and downloadable PNG.">
  <style>
    :root{
      --bg: #e6e1c9;
      --ink: #0f2b2e;
      --accent: #b91c1c;
      --accent-dark: #8f1515;
      --paper: #f5e7c4;
      --brand: #125a5a;
      --brand-ink: #ffffff;
      --ring: #174e4a;
    }
    html, body{ height:100%; }
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Noto Sans JP, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--ink);
    }
    header{ padding: clamp(16px, 3vw, 28px) clamp(16px, 4vw, 40px); }
    h1{ margin:0 0 6px; font-size: clamp(22px, 3.2vw, 36px); letter-spacing:.02em; }
    .sub{ opacity:.8; margin-bottom: 10px; }
    .wrap{
      display:grid; gap:20px; align-items:start;
      grid-template-columns: minmax(280px, 420px) 1fr; padding: 0 clamp(16px, 4vw, 40px) clamp(20px, 4vw, 40px);
    }
    .card{ background: #fff8; backdrop-filter: blur(4px); border:1px solid #00000010; border-radius:16px; box-shadow: 0 10px 25px #0002; }
    .panel{ padding:16px; }
    .controls label{ font-size: 14px; opacity:.8; }
    .controls .row{ display:flex; gap:10px; align-items:center; margin-bottom:10px; }
    input[type="text"], select{
      width:100%; padding:10px 12px; border-radius: 12px; border:1px solid #00000022; font-size: 16px; outline:none;
    }
    button{ cursor:pointer; border:none; border-radius: 12px; padding:12px 14px; font-weight:600; }
    .btn{ background: var(--brand); color: var(--brand-ink); box-shadow: 0 6px 14px #0a3b3b55; }
    .btn.alt{ background:#ffffff; color:var(--brand); border:1px solid var(--brand); box-shadow:none; }
    .btn:active{ transform: translateY(1px); }
    .stack{ display:flex; flex-wrap:wrap; gap:10px; }
    .chip{ padding:8px 12px; border-radius:999px; border:1px solid #0000001a; background:#fff; cursor:pointer; user-select:none; }
    .chip.active{ background:#0f766e; color:#fff; border-color:#0f766e; }

    .preview{ display:grid; place-items:center; padding: 10px; }
    canvas{ width: min(90%, 480px); height: auto; max-height: 78vh; aspect-ratio: 2/3; background: transparent; display:block; }

    .footer{ text-align:center; padding:18px; opacity:.75; font-size:13px; }

    @media (max-width: 900px){
      .wrap{ grid-template-columns: 1fr; }
      canvas{ width: min(96%, 520px); }
    }
  </style>
</head>
<body>
  <header>
    <h1>幸運を味わう — 旅の安全と長寿を願って。</h1>
    <div class="sub">沖縄発・幸運の和牛サンド｜SNS映えする日本のお守りデザインを作ってシェアしよう！ <strong>#wagyu_blessing</strong></div>
  </header>

  <main class="wrap">
    <!-- Controls -->
    <section class="card panel">
      <div class="controls">
        <div class="row">
          <label for="lang">Language</label>
          <select id="lang" aria-label="language">
            <option value="ja">日本語</option>
            <option value="en">English</option>
            <option value="zh">中文</option>
          </select>
        </div>
        <div class="row">
          <label for="name">お名前（任意）</label>
        </div>
        <div class="row">
          <input id="name" type="text" maxlength="24" placeholder="Traveler" />
        </div>

        <div class="row" style="margin-top:6px"><label>背景カラー（SNS映え）</label></div>
        <div id="palette" class="stack" role="listbox" aria-label="背景カラー">
          <!-- chips injected by JS -->
        </div>

        <div class="row" style="margin-top:8px"><label>日本柄（装飾）</label></div>
        <div id="motifs" class="stack">
          <div class="chip active" data-motif="sakura">桜</div>
          <div class="chip active" data-motif="seigaiha">青海波</div>
          <div class="chip active" data-motif="asanoha">麻の葉</div>
        </div>

        <div class="row" style="margin-top:14px; gap:8px;">
          <button class="btn" id="make">願いを込めて お守りを作る</button>
          <button class="btn alt" id="save">PNGを保存</button>
          <button class="btn alt" id="share">シェアする</button>
        </div>
        <p style="font-size:12px; opacity:.75; margin-top:10px;">※ お名前は保存しません。お守り画像の生成のみに使用します。</p>
      </div>
    </section>

    <!-- Preview -->
    <section class="card preview">
      <canvas id="view" width="1200" height="1800" aria-label="お守りプレビュー"></canvas>
    </section>
  </main>

  <div class="footer">© Wagyu Blessing — Hashtag: <strong>#wagyu_blessing</strong></div>

  <script>
  // ===== UI constants =====
  const PALETTE = [
    { key: 'indigo', name: '深い藍', color: '#0f2540' },
    { key: 'sakura', name: '桜ピンク', color: '#FFD6E7' },
    { key: 'jade',   name: '翡翠グリーン', color: '#18a999' },
    { key: 'kurogane', name: '黒 × 金', color: '#0a0a0a', gradient: ['#151515', '#222', '#0a0a0a'] },
    { key: 'turq', name: 'ターコイズ', color: '#10b7b0' },
  ];

  const I18N = {
    ja: { title: 'Blessing Amulet', sub: 'Safe Travels & Long Life', traveler: 'Traveler', tag: '#wagyu_blessing' },
    en: { title: 'Blessing Amulet', sub: 'Safe Travels & Long Life', traveler: 'Traveler', tag: '#wagyu_blessing' },
    zh: { title: '祈福护身符', sub: '旅途平安 · 长命百岁', traveler: 'Traveler', tag: '#wagyu_blessing' },
  };

  // ===== DOM =====
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
  const canvas = $('#view');
  const ctx = canvas.getContext('2d');

  const nameInput = $('#name');
  const langSel = $('#lang');
  const makeBtn = $('#make');
  const saveBtn = $('#save');
  const shareBtn = $('#share');
  const paletteWrap = $('#palette');

  // build color chips
  let currentColorKey = 'turq';
  function buildPalette(){
    PALETTE.forEach(p => {
      const chip = document.createElement('button');
      chip.className = 'chip' + (p.key===currentColorKey? ' active':'' );
      chip.setAttribute('role','option');
      chip.setAttribute('aria-label', p.name);
      chip.textContent = p.name;
      chip.style.borderColor = '#00000022';
      chip.style.background = p.gradient ? `linear-gradient(135deg, ${p.gradient.join(',')})` : p.color;
      chip.style.color = getReadable(p.color||p.gradient?.[0]);
      chip.onclick = ()=>{
        currentColorKey = p.key;
        $$('.chip', paletteWrap).forEach(c=>c.classList.remove('active'));
        chip.classList.add('active');
        draw();
      }
      paletteWrap.appendChild(chip);
    })
  }

  // utils
  function getReadable(hex){
    if(!hex) return '#fff';
    const c = hex.replace('#','');
    const r = parseInt(c.substring(0,2),16), g=parseInt(c.substring(2,4),16), b=parseInt(c.substring(4,6),16);
    const yiq = (r*299 + g*587 + b*114)/1000; // luminance
    return yiq >= 160 ? '#0b1e20' : '#ffffff';
  }

  function pickColor(){
    const p = PALETTE.find(x=>x.key===currentColorKey);
    return p || PALETTE[0];
  }

  // patterns
  function drawSakura(x,y,scale=1,rot=0,color='rgba(0,0,0,0.12)'){
    ctx.save(); ctx.translate(x,y); ctx.rotate(rot); ctx.scale(scale,scale);
    ctx.fillStyle = color; ctx.beginPath();
    for(let i=0;i<5;i++){
      const a = i * (Math.PI*2/5);
      const px = Math.cos(a)*28, py = Math.sin(a)*28;
      ctx.moveTo(0,0); ctx.quadraticCurveTo(px*0.6, py*0.6, px, py);
      ctx.quadraticCurveTo(px*1.2, py*1.2, 0, 0);
    }
    ctx.closePath(); ctx.fill(); ctx.restore();
  }
  function drawSeigaiha(x, y, w, h, color){
    ctx.save(); ctx.strokeStyle = color; ctx.lineWidth = 2;
    const r = 18; // arc radius
    for(let yy=y; yy<y+h; yy+=r){
      for(let xx=x; xx<x+w; xx+=r){
        ctx.beginPath();
        for(let k=1;k<=3;k++){
          ctx.arc(xx, yy, r*k/3, Math.PI, 0);
        }
        ctx.stroke();
      }
    }
    ctx.restore();
  }
  function drawAsanoha(x,y,w,h,color){
    ctx.save(); ctx.strokeStyle = color; ctx.lineWidth = 1.5;
    const s = 24;
    for(let yy=y; yy<y+h+s; yy+=s){
      for(let xx=x; xx<x+w+s; xx+=s){
        ctx.beginPath();
        ctx.moveTo(xx,yy); ctx.lineTo(xx+s/2, yy+s); ctx.lineTo(xx+s, yy); ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(xx,yy+s); ctx.lineTo(xx+s/2, yy); ctx.lineTo(xx+s, yy+s); ctx.stroke();
      }
    }
    ctx.restore();
  }

  function roundedRectPath(x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.lineTo(x+w-r,y); ctx.arcTo(x+w,y,x+w,y+r,r);
    ctx.lineTo(x+w, y+h-r); ctx.arcTo(x+w,y+h,x+w-r,y+h,r);
    ctx.lineTo(x+r, y+h); ctx.arcTo(x,y+h,x,y+h-r,r);
    ctx.lineTo(x, y+r); ctx.arcTo(x,y,x+r,y,r);
  }

  function drawCord(cx,cy,scale=1){
    ctx.save(); ctx.translate(cx,cy); ctx.scale(scale,scale);
    ctx.lineWidth = 26; ctx.strokeStyle = '#fdf3df'; ctx.lineCap='round';
    ctx.beginPath();
    ctx.moveTo(-120,0); ctx.quadraticCurveTo(-40,-80,0,0); ctx.quadraticCurveTo(40,80,120,0);
    ctx.stroke();
    ctx.lineWidth = 12; ctx.strokeStyle = '#efcc8f';
    ctx.beginPath();
    ctx.moveTo(-120,0); ctx.quadraticCurveTo(-40,-80,0,0); ctx.quadraticCurveTo(40,80,120,0);
    ctx.stroke();
    ctx.restore();
  }

  function draw(){
    const lang = I18N[langSel.value] || I18N.ja;
    const name = nameInput.value.trim() || lang.traveler;

    // clear
    ctx.clearRect(0,0,canvas.width, canvas.height);

    // page background (impact color)
    const col = pickColor();
    if(col.gradient){
      const g = ctx.createLinearGradient(0,0, canvas.width, canvas.height);
      col.gradient.forEach((c,i)=> g.addColorStop(i/(col.gradient.length-1), c));
      ctx.fillStyle = g;
    }else{
      ctx.fillStyle = col.color;
    }
    ctx.fillRect(0,0,canvas.width, canvas.height);

    // Omamori base sizes
    const W = canvas.width, H = canvas.height;
    const pad = 120;
    const ow = W - pad*2; const oh = H - pad*2; // outer

    // tag silhouette (outer red body with cut top)
    ctx.save();
    // red body
    ctx.fillStyle = getCSS('--accent');
    ctx.strokeStyle = '#00000040';
    roundedRectPath(pad, pad, ow, oh, 60);
    ctx.fill();

    // top cut (angled shoulders)
    ctx.fillStyle = getCSS('--accent');
    ctx.beginPath();
    ctx.moveTo(pad+120, pad);
    ctx.lineTo(W/2-80, pad); ctx.lineTo(W/2, pad-80); ctx.lineTo(W/2+80, pad); ctx.lineTo(W-pad-120, pad);
    ctx.lineTo(W-pad-120, pad+40); ctx.lineTo(pad+120, pad+40);
    ctx.closePath(); ctx.fill();

    // inner pattern texture
    drawSeigaiha(pad+24, pad+80, ow-48, oh-160, 'rgba(0,0,0,0.12)');
    drawAsanoha(pad+24, pad+80, ow-48, oh-160, 'rgba(0,0,0,0.12)');
    drawSakura(pad+160, pad+200, 1.4, 0.3, 'rgba(0,0,0,0.12)');
    drawSakura(W-pad-200, pad+300, 1.1, -0.2, 'rgba(0,0,0,0.12)');

    // inner panel
    const innerPad = 36;
    ctx.fillStyle = getCSS('--paper');
    roundedRectPath(pad+innerPad, pad+innerPad+80, ow-innerPad*2, oh-innerPad*2-80, 28);
    ctx.fill();
    ctx.restore();

    // cord
    drawCord(W/2, pad+40, 1);

    // text
    ctx.fillStyle = '#1e293b';
    ctx.textAlign = 'center';
    drawText(lang.title, W/2, pad+260, 72, 900);
    ctx.fillStyle = '#334155';
    drawText(lang.sub, W/2, pad+360, 42, 700);

    ctx.fillStyle = '#111827';
    drawText(name, W/2, H - pad - 360, 120, 900);

    // small landscape band
    ctx.save();
    ctx.translate(W/2, H - pad - 260);
    ctx.fillStyle = '#b44';
    ctx.beginPath();
    ctx.moveTo(-380,30); ctx.quadraticCurveTo(-240,-10,-120, 20);
    ctx.quadraticCurveTo(0, 60, 140, 20); ctx.quadraticCurveTo(260,-10, 380, 30);
    ctx.lineTo(380, 120); ctx.lineTo(-380,120); ctx.closePath(); ctx.fill();
    ctx.restore();

    // hashtag
    ctx.fillStyle = '#0b1f1f';
    drawText(I18N.ja.tag, W/2, H - pad - 120, 48, 800);
  }

  function drawText(text, x, y, size, weight){
    ctx.save();
    ctx.font = `${weight || 700} ${size}px/1.25 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans JP, Arial`;
    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillText(text, x, y);
    ctx.restore();
  }

  function getCSS(v){
    return getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  }

  // download helper
  function downloadURI(uri, name){
    const a = document.createElement('a');
    a.href = uri; a.download = name; document.body.appendChild(a); a.click(); a.remove();
  }

  // events
  makeBtn.addEventListener('click', draw);
  saveBtn.addEventListener('click', ()=>{
    const blobUrl = canvas.toDataURL('image/png');
    downloadURI(blobUrl, `omamori_${Date.now()}.png`);
  });
  shareBtn.addEventListener('click', async()=>{
    try{
      if(navigator.canShare && canvas.toBlob){
        canvas.toBlob(async (blob)=>{
          const file = new File([blob], 'omamori.png', {type:'image/png'});
          if(navigator.canShare({ files:[file] })){
            await navigator.share({
              files: [file], title: 'Wagyu Blessing Amulet', text: '#wagyu_blessing'
            });
          }else{
            copy();
          }
        })
      }else{ copy(); }
    }catch(e){ copy(); }

    function copy(){
      navigator.clipboard?.writeText('#wagyu_blessing').then(()=>{
        alert('ハッシュタグ #wagyu_blessing をコピーしました。画像は「PNGを保存」からどうぞ。');
      });
    }
  });

  langSel.addEventListener('change', draw);
  nameInput.addEventListener('input', ()=>{ draw(); });

  // init
  buildPalette();
  nameInput.value = '';
  draw();
  </script>
</body>
</html>
