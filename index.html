<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wagyu Blessing Amulet | #wagyu_blessing</title>
  <meta name="description" content="Create a Japanese Omamori-style blessing card for travelers.">
  <style>
    :root{
      --bg: #10b7b0;
      --ink: #0f2b2e;
      --omamori: #b91c1c;
      --panel: #f5e7c4;
      --outline: #111111;
      --gold: #f6d889;
      --gold-dark: #d8b86a;
      --btn: #125a5a;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      color:var(--ink);
      background:#ece8d3;
    }
    header{padding:18px 22px}
    h1{margin:0 0 6px;font-size:clamp(22px,3.2vw,36px)}
    .sub{opacity:.8}
    .wrap{
      display:grid;
      gap:20px;
      align-items:flex-start;
      grid-template-columns:minmax(280px,420px) 1fr;
      padding:0 22px 28px;
    }
    .card{
      background:#fffffff0;
      border:1px solid #0001;
      border-radius:16px;
      box-shadow:0 10px 24px #0001;
    }
    .panel{padding:16px;position:relative;z-index:1;}
    .controls .row{display:flex;gap:10px;align-items:center;margin:10px 0}
    input,select,button{font-size:16px}
    input[type=text],select{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #0002;
    }
    button{
      cursor:pointer;
      border:none;
      border-radius:12px;
      padding:10px 14px;
      font-weight:600;
    }
    .btn{background:var(--btn);color:#fff}
    .btn.alt{background:#fff;border:1px solid var(--btn);color:var(--btn)}
    .stack{display:flex;flex-wrap:wrap;gap:10px}
    .chip{
      padding:8px 14px;
      border-radius:999px;
      border:1px solid #0002;
      background:#fff;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      background:#0f766e;
      color:#fff;
      border-color:#0f766e;
    }
    .preview{display:grid;place-items:center;padding:10px}
    canvas{
      width:min(92%,520px);
      height:auto;
      max-height:78vh;
      aspect-ratio:2/3;
      display:block;
      background:transparent;
    }
    @media (max-width:900px){
      .wrap{grid-template-columns:1fr}
      canvas{width:min(96%,560px)}
    }
    .hint{font-size:12px;opacity:.7;margin-top:-4px}
    .footer{padding:16px;text-align:center;opacity:.75}
  </style>
</head>
<body>
  <header>
    <h1>幸運を味わう — 旅の安全と長寿を願って。</h1>
    <div class="sub">
      沖縄発・幸運の和牛サンド｜SNS映えする日本のお守りデザインを作ってシェアしよう！
      <strong>#wagyu_blessing</strong>
    </div>
  </header>

  <main class="wrap">
    <!-- 左：操作エリア -->
    <section class="card panel">
      <div class="controls">
        <div class="row">
          <label for="lang">Language</label>
          <select id="lang">
            <option value="ja">日本語</option>
            <option value="en">English</option>
            <option value="zh">中文</option>
          </select>
        </div>

        <div class="row"><label for="name">お名前（任意）</label></div>
        <div class="row">
          <input id="name" type="text" maxlength="24" placeholder="Traveler" />
        </div>

        <div class="row"><label>背景カラー（SNS映え）</label></div>
        <div id="palette" class="stack" aria-label="背景カラー"></div>

        <div class="row"><label>日本柄（装飾）</label></div>
        <div id="motifs" class="stack" aria-label="日本柄の選択">
          <button type="button" class="chip active" data-motif="sakura">桜</button>
          <button type="button" class="chip active" data-motif="seigaiha">青海波</button>
          <button type="button" class="chip active" data-motif="asanoha">麻の葉</button>
        </div>
        <div class="hint">※ ボタンを押すと柄のON/OFFが切り替わります</div>

        <div class="row" style="gap:8px">
          <button class="btn" id="make" type="button">願いを込めて お守りを作る</button>
          <button class="btn alt" id="save" type="button">PNGを保存</button>
          <button class="btn alt" id="share" type="button">シェアする</button>
        </div>

        <p style="font-size:12px;opacity:.75">
          ※ お名前は保存しません。お守り画像の生成のみに使用します。
        </p>
      </div>
    </section>

    <!-- 右：プレビュー -->
    <section class="card preview">
      <canvas id="view" width="1200" height="1800" aria-label="お守りプレビュー"></canvas>
    </section>
  </main>

  <div class="footer">
    © Wagyu Blessing — Hashtag: <strong>#wagyu_blessing</strong>
  </div>

<script>
  // キャンバスを準備
  const canvas = document.getElementById("view");
  const ctx = canvas.getContext("2d");

  // ① 文字なしお守り画像を読み込む
  const base = new Image();
  base.src = "omamori_base.png"; // 同じフォルダに置いた文字なし画像のファイル名

  let baseLoaded = false;
  base.onload = () => {
    baseLoaded = true;
    draw();  // 読み込み完了したら一度描画
  };

  // 入力パーツをとってくる
  const langEl  = document.getElementById("lang");
  const nameEl  = document.getElementById("name");
  const makeBtn = document.getElementById("make");
  const saveBtn = document.getElementById("save");
  const shareBtn = document.getElementById("share");

  // 表示するテキスト（言語ごと）
  const I18N = {
    ja: {
      title: "Blessing Amulet",
      sub: "Safe Travels & Long Life",
      traveler: "Traveler",
    },
    en: {
      title: "Blessing Amulet",
      sub: "Safe Travels & Long Life",
      traveler: "Traveler",
    },
    zh: {
      title: "祈福护身符",
      sub: "旅途平安 · 长命百岁",
      traveler: "Traveler",
    },
  };

  // 文字を描くヘルパー関数
  function drawText(text, x, y, size, weight) {
    ctx.save();
    ctx.font = `${weight} ${size}px "Noto Sans JP", system-ui, -apple-system, "Segoe UI", sans-serif`;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "#221811"; // 濃いめの墨色
    ctx.fillText(text, x, y);
    ctx.restore();
  }

  // メインの描画関数
  function draw() {
    if (!baseLoaded) return; // 画像読み込み前は何もしない

    const W = canvas.width;
    const H = canvas.height;

    // ② まず「文字なしお守り」をそのまま描画
    ctx.clearRect(0, 0, W, H);
    ctx.drawImage(base, 0, 0, W, H);

    // ③ 上から文字を重ねる
    const lang = I18N[langEl.value] || I18N.ja;
    const travelerName = (nameEl.value || "").trim() || lang.traveler;

    // ↓この4つの位置は、あとで微調整してOKです（1200x1800前提の目安）
    drawText(lang.title,        W / 2, 470,  82, "700"); // Blessing Amulet
    drawText(lang.sub,          W / 2, 560,  42, "600"); // Safe Travels & Long Life
    drawText(travelerName,      W / 2, 1200, 96, "700"); // お客様の名前
    drawText("#wagyu_blessing", W / 2, 1520, 48, "600"); // ハッシュタグ
  }

  // ボタンや入力にイベントをつける
  makeBtn.addEventListener("click", draw);
  langEl.addEventListener("change", draw);
  nameEl.addEventListener("input", draw);

  // PNG保存ボタン
  saveBtn.addEventListener("click", () => {
    const data = canvas.toDataURL("image/png");
    const a = document.createElement("a");
    a.href = data;
    a.download = "wagyu_omamori.png";
    a.click();
  });

  // シェアボタン（Web Share API or クリップボード）
  shareBtn.addEventListener("click", () => {
    const tag = "#wagyu_blessing";
    if (navigator.share) {
      navigator.share({ text: tag });
    } else if (navigator.clipboard) {
      navigator.clipboard.writeText(tag);
      alert("ハッシュタグ " + tag + " をコピーしました。");
    }
  });
</script>
</body>
</html>
