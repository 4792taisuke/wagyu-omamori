<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wagyu Blessing Amulet | #wagyu_blessing</title>
<meta name="description" content="Create a Japanese Omamori-style blessing card for travelers. Shareable and downloadable PNG.">
<style>
  :root{
    --bg: #10b7b0;             /* default turquoise background */
    --ink: #0f2b2e;
    --omamori: #b91c1c;        /* omamori red */
    --omamori-dark: #8f1515;
    --panel: #f5e7c4;          /* inner cream */
    --outline: #111111;        /* black outline */
    --gold: #f6d889;           /* knot light */
    --gold-dark: #d8b86a;      /* knot shadow */
    --btn: #125a5a;
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Noto Sans JP, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    color:var(--ink);
    background:#ece8d3;
  }
  header{padding:18px 22px}
  h1{margin:0 0 6px;font-size:clamp(22px,3.2vw,36px)}
  .sub{opacity:.8}
  .wrap{
    display:grid;gap:20px;align-items:start;
    grid-template-columns:minmax(280px,420px) 1fr;
    padding: 0 22px 28px;
  }
  .card{background:#fffffff0;border:1px solid #0001;border-radius:16px;box-shadow:0 10px 24px #0001}
  .panel{padding:16px}
  .controls .row{display:flex;gap:10px;align-items:center;margin:10px 0}
  input,select,button{font-size:16px}
  input[type=text],select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #0002}
  button{cursor:pointer;border:none;border-radius:12px;padding:12px 14px;font-weight:600}
  .btn{background:var(--btn);color:#fff}
  .btn.alt{background:#fff;border:1px solid var(--btn);color:var(--btn)}
  .stack{display:flex;flex-wrap:wrap;gap:10px}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid #0002;background:#fff;user-select:none;cursor:pointer}
  .chip.active{background:#0f766e;color:#fff;border-color:#0f766e}
  .preview{display:grid;place-items:center;padding:10px}
  canvas{width:min(92%,520px);height:auto;max-height:78vh;aspect-ratio:2/3;background:transparent;display:block}
  @media (max-width:900px){
    .wrap{grid-template-columns:1fr}
    canvas{width:min(96%,560px)}
  }
  .footer{padding:16px;text-align:center;opacity:.75}
</style>
</head>
<body>
  <header>
    <h1>幸運を味わう — 旅の安全と長寿を願って。</h1>
    <div class="sub">沖縄発・幸運の和牛サンド｜SNS映えする日本のお守りデザインを作ってシェアしよう！ <strong>#wagyu_blessing</strong></div>
  </header>

  <main class="wrap">
    <!-- Controls -->
    <section class="card panel">
      <div class="controls">
        <div class="row">
          <label for="lang">Language</label>
          <select id="lang" aria-label="language">
            <option value="ja">日本語</option>
            <option value="en">English</option>
            <option value="zh">中文</option>
          </select>
        </div>
        <div class="row"><label for="name">お名前（任意）</label></div>
        <div class="row">
          <input id="name" type="text" maxlength="24" placeholder="Traveler"/>
        </div>
        <div class="row"><label>背景カラー（SNS映え）</label></div>
        <div id="palette" class="stack" role="listbox" aria-label="背景カラー"></div>

        <div class="row"><label>日本柄（装飾）</label></div>
        <div id="motifs" class="stack">
          <div class="chip active" data-motif="sakura">桜</div>
          <div class="chip active" data-motif="seigaiha">青海波</div>
          <div class="chip active" data-motif="asanoha">麻の葉</div>
        </div>

        <div class="row" style="gap:8px">
          <button class="btn" id="make">願いを込めて お守りを作る</button>
          <button class="btn alt" id="save">PNGを保存</button>
          <button class="btn alt" id="share">シェアする</button>
        </div>
        <p style="font-size:12px;opacity:.75">※ お名前は保存しません。お守り画像の生成のみに使用します。</p>
      </div>
    </section>

    <!-- Preview -->
    <section class="card preview">
      <canvas id="view" width="1200" height="1800" aria-label="お守りプレビュー"></canvas>
    </section>
  </main>

  <div class="footer">© Wagyu Blessing — Hashtag: <strong>#wagyu_blessing</strong></div>

<script>
// ===== constants =====
const PALETTE = [
  { key:'turq',   name:'ターコイズ', color:'#10b7b0' },
  { key:'indigo', name:'深い藍', color:'#0f2540' },
  { key:'sakura', name:'桜ピンク', color:'#FFD6E7' },
  { key:'jade',   name:'翡翠グリーン', color:'#18a999' },
  { key:'kurogane',name:'黒 × 金', color:'#0a0a0a', gradient:['#151515','#222','#0a0a0a'] },
];

const I18N = {
  ja:{ title:'Blessing Amulet', sub:'Safe Travels & Long Life', traveler:'Traveler', tag:'#wagyu_blessing' },
  en:{ title:'Blessing Amulet', sub:'Safe Travels & Long Life', traveler:'Traveler', tag:'#wagyu_blessing' },
  zh:{ title:'祈福护身符', sub:'旅途平安 · 长命百岁', traveler:'Traveler', tag:'#wagyu_blessing' },
};

// ===== DOM =====
const $ = (s, r=document)=>r.querySelector(s);
const $$=(s, r=document)=>Array.from(r.querySelectorAll(s));
const canvas = $('#view');
const ctx = canvas.getContext('2d');
const nameInput = $('#name');
const langSel = $('#lang');
const paletteWrap = $('#palette');

const makeBtn = $('#make');
const saveBtn = $('#save');
const shareBtn = $('#share');

let currentColorKey = 'turq';

function buildPalette(){
  PALETTE.forEach(p=>{
    const chip = document.createElement('button');
    chip.className = 'chip' + (p.key===currentColorKey?' active':'');
    chip.textContent = p.name;
    chip.style.background = p.gradient ? `linear-gradient(135deg, ${p.gradient.join(',')})` : p.color;
    chip.style.color = getReadable(p.color || p.gradient?.[0]);
    chip.onclick = ()=>{
      currentColorKey = p.key;
      $$('.chip', paletteWrap).forEach(c=>c.classList.remove('active'));
      chip.classList.add('active');
      draw();
    }
    paletteWrap.appendChild(chip);
  });
}

function getReadable(hex){
  if(!hex) return '#fff';
  const c=hex.replace('#','');
  const r=parseInt(c.slice(0,2),16), g=parseInt(c.slice(2,4),16), b=parseInt(c.slice(4,6),16);
  const yiq=(r*299+g*587+b*114)/1000;
  return yiq>=160 ? '#0b1f1f' : '#ffffff';
}

function pickColor(){
  return PALETTE.find(x=>x.key===currentColorKey) || PALETTE[0];
}

// ===== patterns =====
function drawSeigaiha(x,y,w,h,color){
  ctx.save();
  ctx.strokeStyle = color; ctx.lineWidth = 2;
  const r=22;
  for(let yy=y; yy<y+h; yy+=r){
    for(let xx=x; xx<x+w; xx+=r){
      ctx.beginPath();
      for(let k=1;k<=3;k++){ ctx.arc(xx,yy,r*k/3,Math.PI,0); }
      ctx.stroke();
    }
  }
  ctx.restore();
}
function drawAsanoha(x,y,w,h,color){
  ctx.save();
  ctx.strokeStyle=color; ctx.lineWidth=1.5;
  const s=28;
  for(let yy=y; yy<y+h+s; yy+=s){
    for(let xx=x; xx<x+w+s; xx+=s){
      ctx.beginPath();
      ctx.moveTo(xx,yy); ctx.lineTo(xx+s/2,yy+s); ctx.lineTo(xx+s,yy); ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(xx,yy+s); ctx.lineTo(xx+s/2,yy); ctx.lineTo(xx+s,yy+s); ctx.stroke();
    }
  }
  ctx.restore();
}
function drawSakura(x,y,scale=1,rot=0,color='rgba(0,0,0,.12)'){
  ctx.save(); ctx.translate(x,y); ctx.rotate(rot); ctx.scale(scale,scale);
  ctx.fillStyle = color; ctx.beginPath();
  for(let i=0;i<5;i++){
    const a=i*(Math.PI*2/5);
    const px=Math.cos(a)*28, py=Math.sin(a)*28;
    ctx.moveTo(0,0);
    ctx.quadraticCurveTo(px*.6, py*.6, px, py);
    ctx.quadraticCurveTo(px*1.2, py*1.2, 0, 0);
  }
  ctx.closePath(); ctx.fill(); ctx.restore();
}
function roundedRectPath(x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.lineTo(x+w-r,y); ctx.arcTo(x+w,y,x+w,y+r,r);
  ctx.lineTo(x+w,y+h-r); ctx.arcTo(x+w,y+h,x+w-r,y+h,r);
  ctx.lineTo(x+r,y+h); ctx.arcTo(x,y+h,x,y+h-r,r);
  ctx.lineTo(x,y+r); ctx.arcTo(x,y,x+r,y,r);
}

function drawKnot(cx,cy,scale=1){
  ctx.save();
  ctx.translate(cx,cy); ctx.scale(scale,scale);
  // base loops
  ctx.lineWidth=28; ctx.strokeStyle=getCSS('--gold'); ctx.lineCap='round';
  ctx.beginPath(); ctx.moveTo(-120,0); ctx.quadraticCurveTo(-40,-80,0,0); ctx.quadraticCurveTo(40,80,120,0); ctx.stroke();
  // outline shadow
  ctx.lineWidth=10; ctx.strokeStyle=getCSS('--gold-dark');
  ctx.beginPath(); ctx.moveTo(-120,0); ctx.quadraticCurveTo(-40,-80,0,0); ctx.quadraticCurveTo(40,80,120,0); ctx.stroke();
  ctx.restore();
}

// ===== draw whole poster =====
function draw(){
  const W=canvas.width, H=canvas.height;
  const pad=110;
  const lang=I18N[langSel.value]||I18N.ja;
  const name=nameInput.value.trim()||lang.traveler;

  // background
  const col=pickColor();
  ctx.clearRect(0,0,W,H);
  if(col.gradient){
    const g=ctx.createLinearGradient(0,0,W,H);
    col.gradient.forEach((c,i)=>g.addColorStop(i/(col.gradient.length-1), c));
    ctx.fillStyle=g;
  }else{ ctx.fillStyle=col.color; }
  ctx.fillRect(0,0,W,H);

  // omamori outer
  const ow=W-pad*2, oh=H-pad*2;
  ctx.save();
  // red body
  ctx.fillStyle=getCSS('--omamori');
  roundedRectPath(pad, pad, ow, oh, 56);
  ctx.fill();
  // black outline
  ctx.lineWidth=10; ctx.strokeStyle=getCSS('--outline'); ctx.stroke();

  // angled top cut
  ctx.fillStyle=getCSS('--omamori');
  ctx.beginPath();
  ctx.moveTo(pad+120, pad);
  ctx.lineTo(W/2-86,pad); ctx.lineTo(W/2,pad-86); ctx.lineTo(W/2+86,pad); ctx.lineTo(W-pad-120,pad);
  ctx.lineTo(W-pad-120,pad+44); ctx.lineTo(pad+120,pad+44);
  ctx.closePath(); ctx.fill();
  ctx.strokeStyle=getCSS('--outline'); ctx.lineWidth=10; ctx.stroke();

  // inner patterns
  drawSeigaiha(pad+24, pad+90, ow-48, oh-170, 'rgba(0,0,0,.10)');
  drawAsanoha(pad+24, pad+90, ow-48, oh-170, 'rgba(0,0,0,.10)');
  drawSakura(pad+170, pad+220, 1.45, .2, 'rgba(0,0,0,.10)');
  drawSakura(W-pad-210, pad+340, 1.15, -.3, 'rgba(0,0,0,.10)');

  // inner cream panel with inner maroon border
  const ip=40;
  ctx.fillStyle=getCSS('--panel');
  roundedRectPath(pad+ip, pad+ip+90, ow-ip*2, oh-ip*2-90, 24);
  ctx.fill();
  ctx.lineWidth=14; ctx.strokeStyle='#7b1717'; ctx.stroke();
  ctx.restore();

  // golden knot
  drawKnot(W/2, pad+36, 1);

  // texts inside panel
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillStyle='#222';
  drawText(lang.title, W/2, pad+420, 72, 900);
  ctx.fillStyle='#333';
  drawText(lang.sub,   W/2, pad+500, 42, 700);

  ctx.fillStyle='#111';
  drawText(name, W/2, H-pad-420, 120, 900);

  // landscape band (maroon) at bottom of panel
  ctx.save();
  ctx.translate(W/2, H-pad-330);
  ctx.fillStyle='#a02626';
  ctx.beginPath();
  ctx.moveTo(-360,42); ctx.quadraticCurveTo(-220,-10,-90,30);
  ctx.quadraticCurveTo(0,72,110,30); ctx.quadraticCurveTo(230,-8,360,42);
  ctx.lineTo(360,106); ctx.lineTo(-360,106); ctx.closePath(); ctx.fill();
  ctx.restore();

  // hashtag at bottom on red area
  ctx.fillStyle='#111'; ctx.textAlign='center';
  drawText(I18N.ja.tag, W/2, H - pad - 90, 48, 800);
}

function drawText(text,x,y,size,weight){
  ctx.save();
  ctx.font = `${weight||700} ${size}px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans JP, Arial`;
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText(text,x,y);
  ctx.restore();
}

function getCSS(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim(); }

// helpers
function downloadURI(uri, name){
  const a=document.createElement('a'); a.href=uri; a.download=name;
  document.body.appendChild(a); a.click(); a.remove();
}

// events
buildPalette();
makeBtn.addEventListener('click', draw);
saveBtn.addEventListener('click', ()=>{
  downloadURI(canvas.toDataURL('image/png'), `omamori_${Date.now()}.png`);
});
shareBtn.addEventListener('click', async()=>{
  try{
    if(navigator.canShare && canvas.toBlob){
      canvas.toBlob(async(blob)=>{
        const file=new File([blob],'omamori.png',{type:'image/png'});
        if(navigator.canShare({files:[file]})){
          await navigator.share({files:[file],title:'Wagyu Blessing Amulet',text:'#wagyu_blessing'});
        }else{ copyTag(); }
      });
    }else{ copyTag(); }
  }catch(e){ copyTag(); }
  function copyTag(){
    navigator.clipboard?.writeText('#wagyu_blessing').then(()=>{
      alert('ハッシュタグ #wagyu_blessing をコピーしました。画像は「PNGを保存」からどうぞ。');
    });
  }
});

langSel.addEventListener('change', draw);
nameInput.addEventListener('input', draw);

// initial draw
draw();
</script>
</body>
</html>
