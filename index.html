<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wagyu Blessing Amulet | #wagyu_blessing</title>
  <meta name="description" content="Create a Japanese Omamori-style blessing card for travelers.">
  <style>
    :root{
      --bg: #10b7b0;
      --ink: #0f2b2e;
      --omamori: #b91c1c;
      --panel: #f5e7c4;
      --outline: #111111;
      --gold: #f6d889;
      --gold-dark: #d8b86a;
      --btn: #125a5a;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      color:var(--ink);
      background:#ece8d3;
    }
    header{padding:18px 22px}
    h1{margin:0 0 6px;font-size:clamp(22px,3.2vw,36px)}
    .sub{opacity:.8}
    .wrap{
      display:grid;
      gap:20px;
      align-items:flex-start;
      grid-template-columns:minmax(280px,420px) 1fr;
      padding:0 22px 28px;
    }
    .card{
      background:#fffffff0;
      border:1px solid #0001;
      border-radius:16px;
      box-shadow:0 10px 24px #0001;
    }
    .panel{padding:16px;position:relative;z-index:1;}
    .controls .row{display:flex;gap:10px;align-items:center;margin:10px 0}
    input,select,button{font-size:16px}
    input[type=text],select{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #0002;
    }
    button{
      cursor:pointer;
      border:none;
      border-radius:12px;
      padding:10px 14px;
      font-weight:600;
    }
    .btn{background:var(--btn);color:#fff}
    .btn.alt{background:#fff;border:1px solid var(--btn);color:var(--btn)}
    .stack{display:flex;flex-wrap:wrap;gap:10px}
    .chip{
      padding:8px 14px;
      border-radius:999px;
      border:1px solid #0002;
      background:#fff;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      background:#0f766e;
      color:#fff;
      border-color:#0f766e;
    }
    .preview{display:grid;place-items:center;padding:10px}
    canvas{
      width:min(92%,520px);
      height:auto;
      max-height:78vh;
      aspect-ratio:2/3;
      display:block;
      background:transparent;
    }
    @media (max-width:900px){
      .wrap{grid-template-columns:1fr}
      canvas{width:min(96%,560px)}
    }
    .hint{font-size:12px;opacity:.7;margin-top:-4px}
    .footer{padding:16px;text-align:center;opacity:.75}
  </style>
</head>
<body>
  <header>
    <h1>幸運を味わう — 旅の安全と長寿を願って。</h1>
    <div class="sub">
      沖縄発・幸運の和牛サンド｜SNS映えする日本のお守りデザインを作ってシェアしよう！
      <strong>#wagyu_blessing</strong>
    </div>
  </header>

  <main class="wrap">
    <!-- 左：操作エリア -->
    <section class="card panel">
      <div class="controls">
        <div class="row">
          <label for="lang">Language</label>
          <select id="lang">
            <option value="ja">日本語</option>
            <option value="en">English</option>
            <option value="zh">中文</option>
          </select>
        </div>

        <div class="row"><label for="name">お名前（任意）</label></div>
        <div class="row">
          <input id="name" type="text" maxlength="24" placeholder="Traveler" />
        </div>

        <div class="row"><label>背景カラー（SNS映え）</label></div>
        <div id="palette" class="stack" aria-label="背景カラー"></div>

        <div class="row"><label>日本柄（装飾）</label></div>
        <div id="motifs" class="stack" aria-label="日本柄の選択">
          <button type="button" class="chip active" data-motif="sakura">桜</button>
          <button type="button" class="chip active" data-motif="seigaiha">青海波</button>
          <button type="button" class="chip active" data-motif="asanoha">麻の葉</button>
        </div>
        <div class="hint">※ ボタンを押すと柄のON/OFFが切り替わります</div>

        <div class="row" style="gap:8px">
          <button class="btn" id="make" type="button">願いを込めて お守りを作る</button>
          <button class="btn alt" id="save" type="button">PNGを保存</button>
          <button class="btn alt" id="share" type="button">シェアする</button>
        </div>

        <p style="font-size:12px;opacity:.75">
          ※ お名前は保存しません。お守り画像の生成のみに使用します。
        </p>
      </div>
    </section>

    <!-- 右：プレビュー -->
    <section class="card preview">
      <canvas id="view" width="1200" height="1800" aria-label="お守りプレビュー"></canvas>
    </section>
  </main>

  <div class="footer">
    © Wagyu Blessing — Hashtag: <strong>#wagyu_blessing</strong>
  </div>

<script>
/* ===== データ ===== */
const PALETTE = [
  { key:'turq',   name:'ターコイズ',   color:'#10b7b0' },
  { key:'indigo', name:'深い藍',       color:'#0f2540' },
  { key:'sakura', name:'桜ピンク',     color:'#ffd6e7' },
  { key:'jade',   name:'翡翠グリーン', color:'#18a999' },
  { key:'kurogane',name:'黒 × 金',    gradient:['#151515','#222222','#050505'] }
];

const I18N = {
  ja:{ title:'Blessing Amulet', sub:'Safe Travels & Long Life', traveler:'Traveler', tag:'#wagyu_blessing' },
  en:{ title:'Blessing Amulet', sub:'Safe Travels & Long Life', traveler:'Traveler', tag:'#wagyu_blessing' },
  zh:{ title:'祈福护身符',         sub:'旅途平安 · 长命百岁',             traveler:'Traveler', tag:'#wagyu_blessing' },
};

/* ===== DOM ===== */
const canvas   = document.getElementById('view');
const ctx      = canvas.getContext('2d');
const nameEl   = document.getElementById('name');
const langEl   = document.getElementById('lang');
const paletteEl= document.getElementById('palette');
const motifsEl = document.getElementById('motifs');
const makeBtn  = document.getElementById('make');
const saveBtn  = document.getElementById('save');
const shareBtn = document.getElementById('share');

/* ===== 状態 ===== */
let currentColorKey = 'turq';
const motifs = { sakura:true, seigaiha:true, asanoha:true };

/* ===== ヘルパー ===== */
function getTheme(){
  return PALETTE.find(p=>p.key===currentColorKey) || PALETTE[0];
}
function getCSS(name){
  return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
}
function roundedRectPath(x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.lineTo(x+w-r,y);   ctx.arcTo(x+w,y,x+w,y+r,r);
  ctx.lineTo(x+w,y+h-r); ctx.arcTo(x+w,y+h,x+w-r,y+h,r);
  ctx.lineTo(x+r,y+h);   ctx.arcTo(x,y+h,x,y+h-r,r);
  ctx.lineTo(x,y+r);     ctx.arcTo(x,y,x+r,y,r);
}

/* ===== パターン描画 ===== */
function drawSeigaiha(x,y,w,h,color){
  ctx.save();
  ctx.strokeStyle=color;
  ctx.lineWidth=2;
  const r=22;
  for(let yy=y; yy<y+h; yy+=r){
    for(let xx=x; xx<x+w; xx+=r){
      ctx.beginPath();
      for(let k=1;k<=3;k++){
        ctx.arc(xx,yy,r*k/3,Math.PI,0);
      }
      ctx.stroke();
    }
  }
  ctx.restore();
}
function drawAsanoha(x,y,w,h,color){
  ctx.save();
  ctx.strokeStyle=color;
  ctx.lineWidth=1.5;
  const s=28;
  for(let yy=y; yy<y+h+s; yy+=s){
    for(let xx=x; xx<x+w+s; xx+=s){
      ctx.beginPath();
      ctx.moveTo(xx,yy);   ctx.lineTo(xx+s/2,yy+s); ctx.lineTo(xx+s,yy);   ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(xx,yy+s); ctx.lineTo(xx+s/2,yy);   ctx.lineTo(xx+s,yy+s); ctx.stroke();
    }
  }
  ctx.restore();
}
function drawSakura(x,y,scale,rot,color){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rot);
  ctx.scale(scale,scale);
  ctx.fillStyle=color;
  ctx.beginPath();
  for(let i=0;i<5;i++){
    const a=i*(Math.PI*2/5);
    const px=Math.cos(a)*28;
    const py=Math.sin(a)*28;
    ctx.moveTo(0,0);
    ctx.quadraticCurveTo(px*0.6,py*0.6,px,py);
    ctx.quadraticCurveTo(px*1.2,py*1.2,0,0);
  }
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}
function drawKnot(cx,cy,scale){
  const gold     = getCSS('--gold');
  const goldDark = getCSS('--gold-dark');
  ctx.save();
  ctx.translate(cx,cy);
  ctx.scale(scale,scale);
  ctx.lineWidth=30;
  ctx.lineCap='round';
  ctx.strokeStyle=gold;
  ctx.beginPath();
  ctx.moveTo(-130,0); ctx.quadraticCurveTo(-40,-90,0,0); ctx.quadraticCurveTo(40,90,130,0); ctx.stroke();
  ctx.lineWidth=12;
  ctx.strokeStyle=goldDark;
  ctx.beginPath();
  ctx.moveTo(-130,0); ctx.quadraticCurveTo(-40,-90,0,0); ctx.quadraticCurveTo(40,90,130,0); ctx.stroke();
  ctx.restore();
}
function drawText(text,x,y,size,weight){
  ctx.save();
  ctx.font = `${weight} ${size}px/1.2 system-ui, -apple-system, "Segoe UI", "Noto Sans JP", sans-serif`;
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  ctx.fillText(text,x,y);
  ctx.restore();
}
function drawCoast(x,y,w,h,color){
  ctx.save();
  ctx.translate(x,y);
  ctx.fillStyle=color;

  // 陸地の塊
  ctx.beginPath();
  ctx.moveTo(0,h*0.7);
  ctx.quadraticCurveTo(w*0.2,h*0.3,w*0.4,h*0.45);
  ctx.quadraticCurveTo(w*0.6,h*0.75,w*0.8,h*0.55);
  ctx.quadraticCurveTo(w*0.9,h*0.45,w,h*0.55);
  ctx.lineTo(w,h);
  ctx.lineTo(0,h);
  ctx.closePath();
  ctx.fill();

  // 波線
  ctx.strokeStyle=color;
  ctx.lineWidth=4;
  for(let i=0;i<4;i++){
    const yy = h*0.15 + i*h*0.15;
    ctx.beginPath();
    ctx.moveTo(0,yy);
    ctx.quadraticCurveTo(w*0.25,yy+6,w*0.5,yy);
    ctx.quadraticCurveTo(w*0.75,yy-6,w,yy);
    ctx.stroke();
  }

  ctx.restore();
}

/* ===== 描画メイン ===== */
function draw(){
  const W = canvas.width;
  const H = canvas.height;
  const cx = W/2;

  const lang = I18N[langEl.value] || I18N.ja;
  const travelerName = (nameEl.value || "").trim() || lang.traveler;
  const theme = getTheme();

  // 背景
  ctx.clearRect(0,0,W,H);
  if(theme.gradient){
    const g = ctx.createLinearGradient(0,0,W,H);
    theme.gradient.forEach((c,i)=>g.addColorStop(i/(theme.gradient.length-1), c));
    ctx.fillStyle=g;
  }else{
    ctx.fillStyle=theme.color;
  }
  ctx.fillRect(0,0,W,H);

  const topShoulderY = 320;
  const apexY        = topShoulderY - 130;
  const bottomY      = H - 120;
  const halfBottom   = 360;
  const halfTop      = 280;

  const omamoriColor = getCSS('--omamori');
  const outlineColor = getCSS('--outline');
  const panelColor   = getCSS('--panel');

  // ---- お守り本体（赤）----
  ctx.save();
  ctx.lineJoin = "round";
  ctx.fillStyle = omamoriColor;
  ctx.strokeStyle = outlineColor;
  ctx.lineWidth = 16;

  ctx.beginPath();
  ctx.moveTo(cx, apexY);
  ctx.lineTo(cx + halfTop,   topShoulderY);
  ctx.lineTo(cx + halfBottom,bottomY);
  ctx.lineTo(cx - halfBottom,bottomY);
  ctx.lineTo(cx - halfTop,   topShoulderY);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();
  ctx.restore();

  // ---- 赤い部分に和柄（クリームで後から中央を隠す）----
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(cx, apexY);
  ctx.lineTo(cx + halfTop,   topShoulderY);
  ctx.lineTo(cx + halfBottom,bottomY);
  ctx.lineTo(cx - halfBottom,bottomY);
  ctx.lineTo(cx - halfTop,   topShoulderY);
  ctx.closePath();
  ctx.clip();

  const patternMargin = 40;
  const patternX = cx - halfBottom + patternMargin;
  const patternY = topShoulderY - 20;
  const patternW = halfBottom*2 - patternMargin*2;
  const patternH = bottomY - topShoulderY - 20;

  if(motifs.seigaiha){
    drawSeigaiha(patternX, patternY, patternW, patternH, "rgba(0,0,0,0.12)");
  }
  if(motifs.asanoha){
    drawAsanoha(patternX, patternY, patternW, patternH, "rgba(0,0,0,0.12)");
  }
  if(motifs.sakura){
    drawSakura(cx-230, topShoulderY+40, 1.6,  0.2, "rgba(0,0,0,0.12)");
    drawSakura(cx+210, topShoulderY+220,1.3, -0.3, "rgba(0,0,0,0.12)");
  }
  ctx.restore();

  // ---- 内側パネル（クリーム）----
  const panelTopY    = topShoulderY + 70;
  const panelBottomY = bottomY - 210;
  const panelHalf    = halfBottom - 120;
  const panelX       = cx - panelHalf;
  const panelY       = panelTopY;
  const panelW       = panelHalf*2;
  const panelH       = panelBottomY - panelTopY;
  const panelR       = 32;

  ctx.save();
  ctx.fillStyle = panelColor;
  roundedRectPath(panelX,panelY,panelW,panelH,panelR);
  ctx.fill();
  ctx.lineWidth = 10;
  ctx.strokeStyle = "#b73424";
  ctx.stroke();
  ctx.restore();

  // ---- パネル内の「海のモチーフ」----
  drawCoast(panelX+40, panelY + panelH - 150, panelW-80, 130, "#b73424");

  // ---- 結び ----
  drawKnot(cx, apexY + 40, 1.05);

  // ---- テキスト ----
  const titleY = panelY + 130;
  const subY   = panelY + 220;
  const nameY  = panelY + panelH/2 + 20;

  ctx.fillStyle="#222";
  drawText(lang.title, cx, titleY, 70, 900);
  ctx.fillStyle="#333";
  drawText(lang.sub,   cx, subY,   40, 700);
  ctx.fillStyle="#111";
  drawText(travelerName, cx, nameY, 110, 900);

  // ---- ハッシュタグ（赤い下部）----
  ctx.fillStyle="#111";
  drawText(I18N.ja.tag, cx, bottomY - 60, 46, 800);
}

/* ===== パレット & イベント ===== */
function buildPalette(){
  PALETTE.forEach(p=>{
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "chip" + (p.key===currentColorKey ? " active" : "");
    btn.textContent = p.name;
    if(p.gradient){
      btn.style.background = `linear-gradient(135deg, ${p.gradient.join(",")})`;
      btn.style.color = "#fff";
    }else{
      btn.style.background = p.color;
      btn.style.color = "#fff";
    }
    btn.addEventListener("click", ()=>{
      currentColorKey = p.key;
      [...paletteEl.querySelectorAll(".chip")].forEach(c=>c.classList.remove("active"));
      btn.classList.add("active");
      draw();
    });
    paletteEl.appendChild(btn);
  });
}

motifsEl.addEventListener("click", (e)=>{
  const btn = e.target.closest("[data-motif]");
  if(!btn) return;
  const key = btn.dataset.motif;
  motifs[key] = !motifs[key];
  btn.classList.toggle("active", motifs[key]);
  draw();
});

function downloadURI(uri, filename){
  const a=document.createElement("a");
  a.href=uri;
  a.download=filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
}

/* ===== ボタン操作 ===== */
makeBtn.addEventListener("click", draw);
langEl.addEventListener("change", draw);
nameEl.addEventListener("input", draw);

saveBtn.addEventListener("click", ()=>{
  const data = canvas.toDataURL("image/png");
  downloadURI(data, "omamori_"+Date.now()+".png");
});

shareBtn.addEventListener("click", ()=>{
  try{
    if(navigator.canShare && navigator.canShare({text:"#wagyu_blessing"})){
      navigator.share({title:"Wagyu Blessing Amulet", text:"#wagyu_blessing"});
    }else{
      navigator.clipboard?.writeText("#wagyu_blessing");
      alert("ハッシュタグ #wagyu_blessing をコピーしました。画像は「PNGを保存」からどうぞ。");
    }
  }catch(e){
    navigator.clipboard?.writeText("#wagyu_blessing");
    alert("ハッシュタグ #wagyu_blessing をコピーしました。画像は「PNGを保存」からどうぞ。");
  }
});

/* ===== 初期化 ===== */
buildPalette();
draw();
</script>
</body>
</html>
